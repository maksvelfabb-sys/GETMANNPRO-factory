import streamlit as st
import pandas as pd
from modules.drive_tools import get_file_link_by_name

def show_drawings_catalog():
    """–í—ñ–¥–æ–±—Ä–∞–∂–∞—î —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø–æ—à—É–∫—É —Ç–∞ –ø–µ—Ä–µ–≥–ª—è–¥—É –∫—Ä–µ—Å–ª–µ–Ω—å"""
    
    with st.container(border=True):
        st.markdown("#### üîé –®–≤–∏–¥–∫–∏–π –ø–æ—à—É–∫ –∫—Ä–µ—Å–ª–µ–Ω–Ω—è")
        # –ü–æ–ª–µ –¥–ª—è –≤–≤–µ–¥–µ–Ω–Ω—è –∞—Ä—Ç–∏–∫—É–ª–∞
        sku_to_find = st.text_input("–í–≤–µ–¥—ñ—Ç—å SKU (–ê—Ä—Ç–∏–∫—É–ª) –≤–∏—Ä–æ–±—É", placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥: GMN-01").strip()
        
        if sku_to_find:
            link = get_file_link_by_name(sku_to_find)
            
            if link:
                st.success(f"‚úÖ –ö—Ä–µ—Å–ª–µ–Ω–Ω—è –¥–ª—è **{sku_to_find}** –∑–Ω–∞–π–¥–µ–Ω–æ!")
                st.link_button(f"üìÑ –í—ñ–¥–∫—Ä–∏—Ç–∏ –∫—Ä–µ—Å–ª–µ–Ω–Ω—è {sku_to_find}", link, width="stretch", type="primary")
                
                # –ú–æ–∂–Ω–∞ –¥–æ–¥–∞—Ç–∏ iframe –¥–ª—è –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ–≥–æ –ø–µ—Ä–µ–≥–ª—è–¥—É (—è–∫—â–æ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –ø—Ä—è–º–µ)
                st.info("üí° –§–∞–π–ª –≤—ñ–¥–∫—Ä–∏—î—Ç—å—Å—è —É –Ω–æ–≤—ñ–π –≤–∫–ª–∞–¥—Ü—ñ –≤–∞—à–æ–≥–æ –±—Ä–∞—É–∑–µ—Ä–∞ —á–µ—Ä–µ–∑ Google Drive.")
            else:
                st.error(f"‚ùå –ö—Ä–µ—Å–ª–µ–Ω–Ω—è –¥–ª—è '{sku_to_find}' –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ.")
                st.caption("–ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è, —â–æ –Ω–∞–∑–≤–∞ —Ñ–∞–π–ª—É –Ω–∞ Drive —Ç–æ—á–Ω–æ –∑–±—ñ–≥–∞—î—Ç—å—Å—è –∑ –∞—Ä—Ç–∏–∫—É–ª–æ–º.")

    st.divider()
    
    # –°–µ–∫—Ü—ñ—è —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó
    with st.expander("‚ÑπÔ∏è –Ø–∫ –ø—Ä–∞—Ü—é—î —Å–∏—Å—Ç–µ–º–∞ –∫—Ä–µ—Å–ª–µ–Ω—å?"):
        st.write("""
        1. –í—Å—ñ –∫—Ä–µ—Å–ª–µ–Ω–Ω—è –º–∞—é—Ç—å –±—É—Ç–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—ñ –≤ —Å–ø–µ—Ü—ñ–∞–ª—å–Ω—É –ø–∞–ø–∫—É –Ω–∞ **Google Drive**.
        2. –ù–∞–∑–≤–∞ —Ñ–∞–π–ª—É –ø–æ–≤–∏–Ω–Ω–∞ –±—É—Ç–∏ —ñ–¥–µ–Ω—Ç–∏—á–Ω–æ—é –¥–æ **–ê—Ä—Ç–∏–∫—É–ª—É (SKU)** –≤ –±–∞–∑—ñ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, —Ñ–∞–π–ª `102.pdf` –¥–ª—è –∞—Ä—Ç–∏–∫—É–ª—É `102`).
        3. –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≥–µ–Ω–µ—Ä—É—î –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–µ—Ä–µ–≥–ª—è–¥ –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è.
        """)

def render_drawings_list(skus):
    """
    –¶—é —Ñ—É–Ω–∫—Ü—ñ—é –º–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ view.py (–≤ –∫–∞—Ä—Ç–∫–∞—Ö –∑–∞–º–æ–≤–ª–µ–Ω—å).
    –í–æ–Ω–∞ –≤–∏–≤–æ–¥–∏—Ç—å –∫–Ω–æ–ø–∫–∏ –∫—Ä–µ—Å–ª–µ–Ω—å —É —Ä—è–¥.
    """
    if not skus:
        return
    
    cols = st.columns(len(skus) if len(skus) <= 4 else 4)
    for i, sku in enumerate(skus):
        if not sku: continue
        link = get_file_link_by_name(str(sku))
        with cols[i % 4]:
            if link:
                st.link_button(f"üìÑ {sku}", link, width="stretch")
            else:
                st.caption(f"üö´ {sku}")

def render_drawings_list(skus):
    """
    –£–Ω—ñ–≤–µ—Ä—Å–∞–ª—å–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —Å–ø–∏—Å–∫—É –∫—Ä–µ—Å–ª–µ–Ω—å –∑–∞ —Å–ø–∏—Å–∫–æ–º –∞—Ä—Ç–∏–∫—É–ª—ñ–≤.
    –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è —ñ –≤ –∫–∞—Ç–∞–ª–æ–∑—ñ, —ñ –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –∑–∞–º–æ–≤–ª–µ–Ω—å.
    """
    if not skus:
        st.caption("–ê—Ä—Ç–∏–∫—É–ª–∏ –Ω–µ –≤–∫–∞–∑–∞–Ω—ñ ‚Äî –∫—Ä–µ—Å–ª–µ–Ω–Ω—è –≤—ñ–¥—Å—É—Ç–Ω—ñ.")
        return

    # –û—á–∏—â—É—î–º–æ —Å–ø–∏—Å–æ–∫ –≤—ñ–¥ –ø–æ—Ä–æ–∂–Ω—ñ—Ö –∑–Ω–∞—á–µ–Ω—å
    active_skus = [str(s).strip() for s in skus if str(s).strip()]
    
    if not active_skus:
        st.caption("–ù–µ–º–∞—î –∫–æ—Ä–µ–∫—Ç–Ω–∏—Ö –∞—Ä—Ç–∏–∫—É–ª—ñ–≤ –¥–ª—è –ø–æ—à—É–∫—É.")
        return

    # –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –∫–Ω–æ–ø–∫–∞–º–∏ –≤ —Ä—è–¥ (–ø–æ 4 —É —Ä—è–¥–∫—É)
    cols = st.columns(4)
    for i, sku in enumerate(active_skus):
        link = get_file_link_by_name(sku)
        with cols[i % 4]:
            if link:
                st.link_button(f"üìÑ {sku}", link, width="stretch", help=f"–í—ñ–¥–∫—Ä–∏—Ç–∏ –∫—Ä–µ—Å–ª–µ–Ω–Ω—è –¥–ª—è {sku}")
            else:
                st.button(f"‚ùå {sku}", disabled=True, width="stretch", help="–§–∞–π–ª –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ –Ω–∞ Drive")

def show_drawings_catalog():
    """
    –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –æ–∫—Ä–µ–º–æ—ó —Å—Ç–æ—Ä—ñ–Ω–∫–∏ '–ö—Ä–µ—Å–ª–µ–Ω–Ω—è' —É –±—ñ—á–Ω—ñ–π –ø–∞–Ω–µ–ª—ñ.
    """
    st.markdown("### üîç –ì–ª–æ–±–∞–ª—å–Ω–∏–π –ø–æ—à—É–∫ –∫—Ä–µ—Å–ª–µ–Ω—å")
    search_sku = st.text_input("–í–≤–µ–¥—ñ—Ç—å –∞—Ä—Ç–∏–∫—É–ª (SKU) –¥–ª—è —à–≤–∏–¥–∫–æ–≥–æ –ø–æ—à—É–∫—É", placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥: GMN-102")
    
    if search_sku:
        st.write(f"–†–µ–∑—É–ª—å—Ç–∞—Ç –¥–ª—è: **{search_sku}**")
        render_drawings_list([search_sku])
    
    st.divider()
    st.info("üí° –ü—ñ–¥–∫–∞–∑–∫–∞: –ö—Ä–µ—Å–ª–µ–Ω–Ω—è —à—É–∫–∞—é—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤ –ø–∞–ø—Ü—ñ –Ω–∞ Google Drive –∑–∞ –Ω–∞–∑–≤–æ—é —Ñ–∞–π–ª—É, —è–∫–∞ –∑–±—ñ–≥–∞—î—Ç—å—Å—è –∑ –ê—Ä—Ç–∏–∫—É–ª–æ–º.")
