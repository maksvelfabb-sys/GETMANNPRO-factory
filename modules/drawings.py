import streamlit as st
from modules.drive_tools import get_file_link_by_name

def render_drawings_list(skus):
    """
    –£–Ω—ñ–≤–µ—Ä—Å–∞–ª—å–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –∫–Ω–æ–ø–æ–∫ –∫—Ä–µ—Å–ª–µ–Ω—å.
    –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –≤ –∫–∞—Ä—Ç–∫–∞—Ö –∑–∞–º–æ–≤–ª–µ–Ω—å —Ç–∞ –≤ –∫–∞—Ç–∞–ª–æ–∑—ñ.
    """
    if not skus:
        st.caption("–ê—Ä—Ç–∏–∫—É–ª–∏ –Ω–µ –≤–∫–∞–∑–∞–Ω—ñ ‚Äî –∫—Ä–µ—Å–ª–µ–Ω–Ω—è –≤—ñ–¥—Å—É—Ç–Ω—ñ.")
        return

    # –û—á–∏—â—É—î–º–æ —Å–ø–∏—Å–æ–∫ –≤—ñ–¥ –ø–æ—Ä–æ–∂–Ω—ñ—Ö –∑–Ω–∞—á–µ–Ω—å —Ç–∞ –¥—É–±–ª—ñ–∫–∞—Ç—ñ–≤
    active_skus = sorted(list(set(str(s).strip() for s in skus if str(s).strip())))
    
    if not active_skus:
        st.caption("–ù–µ–º–∞—î –∫–æ—Ä–µ–∫—Ç–Ω–∏—Ö –∞—Ä—Ç–∏–∫—É–ª—ñ–≤ –¥–ª—è –ø–æ—à—É–∫—É.")
        return

    # –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –∫–Ω–æ–ø–∫–∞–º–∏ –≤ —Ä—è–¥ (–ø–æ 4 —É —Ä—è–¥–∫—É)
    cols = st.columns(4)
    for i, sku in enumerate(active_skus):
        link = get_file_link_by_name(sku)
        with cols[i % 4]:
            if link:
                st.link_button(f"üìÑ {sku}", link, use_container_width=True, help=f"–í—ñ–¥–∫—Ä–∏—Ç–∏ —Ñ–∞–π–ª –¥–ª—è {sku}")
            else:
                # –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ caption –∞–±–æ –∑–∞–±–ª–æ–∫–æ–≤–∞–Ω—É –∫–Ω–æ–ø–∫—É –¥–ª—è –≤—ñ–¥—Å—É—Ç–Ω—ñ—Ö —Ñ–∞–π–ª—ñ–≤
                st.button(f"‚ùå {sku}", disabled=True, use_container_width=True, help="–§–∞–π–ª –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ –Ω–∞ Drive")

def show_drawings_catalog():
    """
    –û—Å–Ω–æ–≤–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è –º–æ–¥—É–ª—è –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —Ü—ñ–ª–æ—ó —Å—Ç–æ—Ä—ñ–Ω–∫–∏ '–ö—Ä–µ—Å–ª–µ–Ω–Ω—è'.
    """
    st.markdown("### üîç –ì–ª–æ–±–∞–ª—å–Ω–∏–π –ø–æ—à—É–∫ –∫—Ä–µ—Å–ª–µ–Ω—å")
    
    with st.container(border=True):
        search_sku = st.text_input(
            "–í–≤–µ–¥—ñ—Ç—å –∞—Ä—Ç–∏–∫—É–ª (SKU) –¥–ª—è —à–≤–∏–¥–∫–æ–≥–æ –ø–æ—à—É–∫—É", 
            placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥: GMN-102"
        ).strip()
        
        if search_sku:
            st.write(f"–†–µ–∑—É–ª—å—Ç–∞—Ç –¥–ª—è: **{search_sku}**")
            render_drawings_list([search_sku])
            
            # –î–æ–¥–∞—Ç–∫–æ–≤–∞ —ñ–Ω—Ñ–æ-–ø–∞–Ω–µ–ª—å, —è–∫—â–æ —Ñ–∞–π–ª –∑–Ω–∞–π–¥–µ–Ω–æ
            link = get_file_link_by_name(search_sku)
            if link:
                st.info("üí° –§–∞–π–ª –∑–Ω–∞–π–¥–µ–Ω–æ. –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –Ω–∞ –∫–Ω–æ–ø–∫—É –≤–∏—â–µ, —â–æ–± –≤—ñ–¥–∫—Ä–∏—Ç–∏ –π–æ–≥–æ –≤ –Ω–æ–≤—ñ–π –≤–∫–ª–∞–¥—Ü—ñ.")
    
    st.divider()
    
    # –Ü–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è –¥–ª—è –ø–µ—Ä—Å–æ–Ω–∞–ª—É
    with st.expander("‚ÑπÔ∏è –Ø–∫ –ø—Ä–∞—Ü—é—î —Å–∏—Å—Ç–µ–º–∞ –∫—Ä–µ—Å–ª–µ–Ω—å?"):
        st.markdown("""
        1. **–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è**: –í—Å—ñ PDF/JPG –∫—Ä–µ—Å–ª–µ–Ω–Ω—è –º–∞—é—Ç—å –±—É—Ç–∏ –≤ –ø–∞–ø—Ü—ñ 'Drawings' –Ω–∞ Google Drive.
        2. **–Ü–º–µ–Ω—É–≤–∞–Ω–Ω—è**: –ù–∞–∑–≤–∞ —Ñ–∞–π–ª—É –ø–æ–≤–∏–Ω–Ω–∞ **—Ç–æ—á–Ω–æ** –∑–±—ñ–≥–∞—Ç–∏—Å—è –∑ SKU (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `GMN-102.pdf`).
        3. **–û–Ω–æ–≤–ª–µ–Ω–Ω—è**: –Ø–∫—â–æ –≤–∏ –¥–æ–¥–∞–ª–∏ —Ñ–∞–π–ª, –∞ –≤—ñ–Ω –Ω–µ –∑'—è–≤–∏–≤—Å—è ‚Äî –∑–∞—á–µ–∫–∞–π—Ç–µ 1-2 —Ö–≤–∏–ª–∏–Ω–∏ (
